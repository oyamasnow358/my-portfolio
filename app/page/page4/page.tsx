"use client";
import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { 
  ArrowLeft, Cpu, Copy, CheckCircle, FileText, 
  Lightbulb, Sparkles, MessageSquare, Settings, 
  ChevronDown, ChevronUp, Download
} from "lucide-react";
import Link from "next/link";

// Excelæ“ä½œç”¨
import ExcelJS from "exceljs";
// @ts-ignore
import { saveAs } from "file-saver";

// ==========================================
// å®šæ•°ãƒ»è¨­å®š
// ==========================================
const SUBJECT_OPTIONS = [
  "è‡ªç«‹æ´»å‹•", "æ—¥å¸¸ç”Ÿæ´»ã®æŒ‡å°", "è·æ¥­", "ç”Ÿæ´»å˜å…ƒå­¦ç¿’", "ä½œæ¥­å­¦ç¿’", 
  "å›½èª", "ç®—æ•°", "ç¾è¡“", "ç†ç§‘", "ç¤¾ä¼š", "éŸ³æ¥½", "å›³ç”»å·¥ä½œ", 
  "ä½“è‚²", "å®¶åº­", "å¤–å›½èªæ´»å‹•", "ç·åˆçš„ãªå­¦ç¿’ã®æ™‚é–“", "ä¿é™º", "æ•°å­¦"
];

const LOGO_PATH = "/MieeL2.png"; 

export default function AiPlanningPage() {
  // ==========================================
  // Stateç®¡ç†
  // ==========================================
  const [mode, setMode] = useState<"normal" | "excel">("normal");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ç”¨
  const [p1Input, setP1Input] = useState("è¦–åŠ›ãŒå¼±ã„ã€è½ã¡ç€ããŒãªã„ã€ç–²ã‚Œã‚„ã™ã„ã€éŸ³ã«æ•æ„Ÿã€è©±ã—ã‹ã‘ã‚‰ã‚Œã‚‹ã¨æ··ä¹±ã™ã‚‹ã€åŒã˜è¡Œå‹•ã‚’ç¹°ã‚Šè¿”ã™");
  const [p1Output, setP1Output] = useState("");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ç”¨
  const [p2Input, setP2Input] = useState("ï¼ˆä¾‹ï¼‰å¯¾è±¡å…ç«¥ã¯ç¾åœ¨ã€æ„Ÿè¦šéæ•ãŒã‚ã‚Š...");
  const [p2Output, setP2Output] = useState("");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ç”¨
  const [p3Input, setP3Input] = useState("è¦–åŠ›ãŒå¼±ã„ã€è½ã¡ç€ããŒãªã„ã€ç–²ã‚Œã‚„ã™ã„ã€éŸ³ã«æ•æ„Ÿã€è©±ã—ã‹ã‘ã‚‰ã‚Œã‚‹ã¨æ··ä¹±ã™ã‚‹ã€åŒã˜è¡Œå‹•ã‚’ç¹°ã‚Šè¿”ã™");
  const [p3Output, setP3Output] = useState("");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ç”¨
  const [p4SelectedSubjects, setP4SelectedSubjects] = useState<string[]>([]);
  const [p4SubjectInputs, setP4SubjectInputs] = useState<Record<string, string>>({});
  const [p4Reference, setP4Reference] = useState("ï¼ˆä¾‹ï¼šæ–‡å­—ã‚’èª­ã‚€ã“ã¨ã«æŠµæŠ—ãŒã‚ã‚‹ã€æ•°ã®æ¦‚å¿µãŒç†è§£ã—ã¥ã‚‰ã„ã€è½ã¡ç€ã„ã¦åº§ã£ã¦ã„ã‚‰ã‚Œãªã„ã€å‹é”ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‹¦æ‰‹ãªã©ï¼‰ã€ä¸é©åˆ‡è¡Œå‹•ãŒèµ·ããŸæ™‚ã«ç¹°ã‚Šè¿”ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚çµµã‚«ãƒ¼ãƒ‰ã‚„æ‰‹è©±ã«ã‚ˆã‚‹è¦æ±‚ã‚’å¢—ã‚„ã™ã€‚ãªã©ï¼‰");
  const [p4Output, setP4Output] = useState("");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¤ç”¨
  const [p5UseFile, setP5UseFile] = useState(false);
  const [p5Reference, setP5Reference] = useState("ï¼ˆä¾‹ï¼šå€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ã®ã€ŒæŒ‡å°ã®ç›®æ¨™ãŠã‚ˆã³å†…å®¹ã€ã®å…¨æ–‡ã‚„ã€ç‰¹ã«è¦‹ã¦ã»ã—ã„éƒ¨åˆ†ãªã©ï¼‰");
  const [p5Activity, setP5Activity] = useState("ã€è‡ªç«‹æ´»å‹•ã€‘ï¼šãƒ»æ•™å“¡ã®èª˜å°ã§è‚©ã‚„é¦–ã®åŠ›ã‚’æŠœãã€èƒ¸ã‚’å¼µã£ãŸå§¿å‹¢ã§æ´»å‹•ã§ããŸã€‚ãƒ»ç‰‡æ‰‹ã§æ”¯ãˆãªãŒã‚‰ç‰‡è¶³ç«‹ã¡ãŒã§ããŸã€‚\nã€å›½èªã€‘ï¼šè‡ªåˆ†ã®åå‰ã‚’ä¸å¯§ã«ãªãã‚Šæ›¸ãã§ããŸã€‚");
  const [p5Output, setP5Output] = useState("");

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¥ç”¨
  const [p6Term, setP6Term] = useState<"å‰æœŸ" | "å¾ŒæœŸï¼å­¦å¹´æœ«">("å‰æœŸ");
  const [p6UseFile, setP6UseFile] = useState(false);
  const [p6Reference, setP6Reference] = useState("ï¼ˆä¾‹ï¼šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ã§ä½œæˆã—ãŸè©•ä¾¡æ–‡ã®å…¨ä½“ã€ã¾ãŸã¯ç‰¹ã«è¦‹ã¦ã»ã—ã„éƒ¨åˆ†ãªã©ï¼‰");
  const [p6Points, setP6Points] = useState("- å¤§ããªã‘ãŒã‚‚ãªãå…ƒæ°—ã«ç™»æ ¡ã§ããŸã“ã¨ã®å–œã³ã€‚\n- å‹äººã¨ã®é–¢ã‚ã‚ŠãŒå‰å‘ãã«ãªã£ãŸç‚¹ã€‚\n- å®¿æ³Šå­¦ç¿’ãªã©ã®å¤§ããªè¡Œäº‹ã‚’ä¹—ã‚Šè¶ŠãˆãŸè‡ªä¿¡ã€‚\n- å®¶åº­ã¨ã®é€£æºã¸ã®æ„Ÿè¬ã€‚");
  const [p6Output, setP6Output] = useState("");

  // Excelç”¨
  const [json1, setJson1] = useState("");
  const [json2, setJson2] = useState("");
  const [json3, setJson3] = useState("");
  const [isGenerating, setIsGenerating] = useState(false);

  // ==========================================
  // ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•°
  // ==========================================

  const copyToClipboard = (text: string) => {
    if (!text) return;
    navigator.clipboard.writeText(text);
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  };

  // --- Excelç”Ÿæˆå‡¦ç† (ä¿®æ­£ç‰ˆ: JSONæŠ½å‡ºå¼·åŒ–) ---
  const handleGenerateExcel = async () => {
    setIsGenerating(true);
    try {
      // 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
      const response = await fetch("/ãƒ—ãƒ©ãƒ³.xlsx");
      if (!response.ok) throw new Error("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(ãƒ—ãƒ©ãƒ³.xlsx)ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚publicãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚");
      
      const arrayBuffer = await response.arrayBuffer();
      const workbook = new ExcelJS.Workbook();
      await workbook.xlsx.load(arrayBuffer);

      // â˜… JSONæŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼ (ã“ã“ã‚’å¼·åŒ–)
      const extractJSON = (input: string) => {
        try {
          if (!input) return null;
          // æœ€åˆã«è¦‹ã¤ã‹ã‚‹ '{' ã‹ã‚‰ æœ€å¾Œã«è¦‹ã¤ã‹ã‚‹ '}' ã¾ã§ã‚’åˆ‡ã‚Šå‡ºã™
          const start = input.indexOf('{');
          const end = input.lastIndexOf('}');
          
          if (start === -1 || end === -1 || start >= end) {
            console.warn("æœ‰åŠ¹ãªJSONæ‹¬å¼§ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:", input);
            return null;
          }
          
          const jsonString = input.substring(start, end + 1);
          return JSON.parse(jsonString);
        } catch (e) {
          console.error("JSON Parse Error:", e);
          alert("è²¼ã‚Šä»˜ã‘ã‚‰ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚AIã®å‡ºåŠ›ãŒæ­£ã—ã„JSONå½¢å¼ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          return null;
        }
      };

      // æ›¸ãè¾¼ã¿ãƒ˜ãƒ«ãƒ‘ãƒ¼
      const writeCell = (sheetName: string, cellAddress: string, value: string) => {
        const sheet = workbook.getWorksheet(sheetName);
        if (sheet) {
          const cell = sheet.getCell(cellAddress);
          // å€¤ã‚’ã‚»ãƒƒãƒˆ
          cell.value = value;
          // æ›¸å¼è¨­å®šï¼ˆæŠ˜ã‚Šè¿”ã—ã€å·¦ä¸Šæƒãˆï¼‰
          cell.alignment = { wrapText: true, vertical: 'top', horizontal: 'left' };
        } else {
          console.warn(`ã‚·ãƒ¼ãƒˆã€Œ${sheetName}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Excelãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ¼ãƒˆåã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
        }
      };

      let hasWritten = false;

      // 2. æ›¸ãè¾¼ã¿å®Ÿè¡Œ
      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘  (ãƒ—ãƒ©ãƒ³A)
      if (json1.trim()) {
        const data1 = extractJSON(json1);
        if (data1) {
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¡", "D12", data1.needs || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¡", "D15", data1.accommodations || "");
          hasWritten = true;
        }
      }
      
      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ (ãƒ—ãƒ©ãƒ³A)
      if (json2.trim()) {
        const data2 = extractJSON(json2);
        if (data2) {
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¡", "D18", data2.goals || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¡", "E18", data2.support || "");
          hasWritten = true;
        }
      }
      
      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ (ãƒ—ãƒ©ãƒ³B)
      if (json3.trim()) {
        const data3 = extractJSON(json3);
        if (data3) {
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "C5", data3.policy || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D8", data3.status_1 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D10", data3.status_2 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D12", data3.status_3 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D14", data3.status_4 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D16", data3.status_5 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D18", data3.status_6 || "");
          writeCell("ãƒ—ãƒ©ãƒ³ï¼¢(å®Ÿæ…‹)", "D20", data3.status_7 || "");
          hasWritten = true;
        }
      }

      if (!hasWritten) {
        alert("å…¥åŠ›æ¬„ãŒç©ºã€ã¾ãŸã¯æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
        setIsGenerating(false);
        return;
      }

      // 3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      const buffer = await workbook.xlsx.writeBuffer();
      const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
      saveAs(blob, "ãƒ—ãƒ©ãƒ³_æ›´æ–°ç‰ˆ.xlsx");
      
      alert("Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");

    } catch (error) {
      console.error(error);
      alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error}\nè©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
    } finally {
      setIsGenerating(false);
    }
  };

  // --- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ (çœç•¥ãªã—) ---

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ 
  const generatePrompt1 = () => {
    const commonInstructions = `
ã€å‡ºåŠ›é …ç›®ã€‘ï¼š
1.ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚º

ãƒ»å…¥åŠ›ã‹ã‚‰å…±é€šæ€§ã‚’è¦‹å‡ºã—ã€2ï½3ã¤ã®æŠ½è±¡çš„ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«åˆ†é¡ã™ã‚‹ï¼ˆè¡¨è¨˜ã¯â‘ ï½â‘¢ã®å½¢ã€â€»å¿…ãšã—ã‚‚â‘¢ã¾ã§å¿…è¦ã¨ã—ãªã„å…¥åŠ›å†…å®¹ã‚„æ·»ä»˜è³‡æ–™ã«ã‚ˆã‚Šè‡¨æ©Ÿå¿œå¤‰ã«ã€‘ï¼‰ã€‚
ãƒ»å„ãƒ‹ãƒ¼ã‚ºã¯20ã€œ100å­—ç¨‹åº¦ã§ã€å…ç«¥ãƒ»ç”Ÿå¾’ã®å®Ÿæ…‹ã‚’æŸ”ã‚‰ã‹ãæ•™è‚²çš„ã«ã¾ã¨ã‚ã‚‹ã€‚
ãƒ»å…·ä½“çš„ãªå‡ºåŠ›ã®å½¢ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
å¯¾è±¡å…ç«¥ï¼ˆç”Ÿå¾’ï¼‰ã¯ç¾åœ¨ã€ä»¥ä¸‹ã®çŠ¶æ³ã§ã‚ã‚‹ã€‚ã€â†å¿…ãšã“ã®æ–‡è¨€ã§å§‹ã‚ã‚‹ã€‘
â‘  ï¼ˆå…¥åŠ›å†…å®¹ã‚’æ•´ç†ã—ã¦ã¾ã¨ã‚ãŸèª²é¡Œã€å›°é›£ã•ã€ç‰¹å¾´ï¼‰
â‘¡ ï¼ˆå…¥åŠ›å†…å®¹ã‚’æ•´ç†ã—ã¦ã¾ã¨ã‚ãŸèª²é¡Œã€å›°é›£ã•ã€ç‰¹å¾´ï¼‰
â‘¢ ï¼ˆå…¥åŠ›å†…å®¹ã‚’æ•´ç†ã—ã¦ã¾ã¨ã‚ãŸèª²é¡Œã€å›°é›£ã•ã€ç‰¹å¾´ï¼‰
â€» å†…å®¹ã¯ã€Œæ—¥å¸¸ç”Ÿæ´»ãƒ»å­¦ç¿’ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»è¡Œå‹•ãƒ»èº«ä½“ãƒ»æ„Ÿè¦šãƒ»å¿ƒç†ã€ãªã©ã‹ã‚‰ã€å…¥åŠ›å†…å®¹ã«å¿œã˜ã¦é©åˆ‡ã«é¸ã‚“ã§ã¾ã¨ã‚ã‚‹ã“ã¨ã€‚

å¾“ã£ã¦ã€ä»¥ä¸‹ã®æ”¯æ´ãŒå¿…è¦ã§ã‚ã‚‹ã€‚ã€â†å¿…ãšã“ã®æ–‡è¨€ã§å§‹ã‚ã‚‹ã€‘
â‘  ï¼ˆâ‘ ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸæ”¯æ´ç›®æ¨™ã‚„æ–¹æ³•ï¼‰
â‘¡ ï¼ˆâ‘¡ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸæ”¯æ´ç›®æ¨™ã‚„æ–¹æ³•ï¼‰
â‘¢ ï¼ˆâ‘¢ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸæ”¯æ´ç›®æ¨™ã‚„æ–¹æ³•ï¼‰

æ”¯æ´ã«å½“ãŸã£ã¦ã¯ã€ä»¥ä¸‹ã®é…æ…®ãŒå¿…è¦ã§ã‚ã‚‹ã€‚ã€â†å¿…ãšã“ã®æ–‡è¨€ã§å§‹ã‚ã‚‹ã€‘
â‘  ï¼ˆâ‘ ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸé…æ…®ï¼‰
â‘¡ ï¼ˆâ‘¡ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸé…æ…®ï¼‰
â‘¢ ï¼ˆâ‘¢ã®çŠ¶æ³ã«å¯¾å¿œã—ãŸé…æ…®ï¼‰

2.åˆç†çš„é…æ…®ã®å®Ÿæ–½å†…å®¹
ãƒ»ä¸Šè¨˜â‘ ã®ãƒ‹ãƒ¼ã‚ºã«å¯¾å¿œã—ãŸåˆç†çš„é…æ…®ã‚’å°‘ãªãã¨ã‚‚2ã¤ä»¥ä¸Šææ¡ˆã™ã‚‹ã€‚
ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ã«2ã¤ä»¥ä¸Šç®‡æ¡æ›¸ãã§ç¤ºã™ã€‚ï¼ˆä¾‹ï¼šã€Œå…·ä½“ç‰©ã‚’ç¤ºã—ã€è¦–è¦šçš„ãªæ”¯æ´ã‚’è¡Œã†ã€‚ã€ã€ã€Œè½ã¡ç€ã‘ã‚‹ç’°å¢ƒè¨­å®šã«ã™ã‚‹ã€‚ã€ã€ã€Œç”Ÿå¾’ãŒå¥½ããªæ„Ÿè§¦ã®æœ¬ã‚„éŸ³ã®å‡ºã‚‹ç©å…·ç­‰ã‚’æ•™å®¤å†…ã«ç”¨æ„ã—ã€å¿ƒç†çš„å®‰å®šã‚’å›³ã‚‹ã€‚ã€ãªã©ï¼‰ã€‚

ã€æ¡ä»¶ã€‘ï¼š
- æ·»ä»˜è³‡æ–™ãŒã‚ã‚‹å ´åˆï¼ˆã€Œãƒ—ãƒ©ãƒ³Aã€ã‚„ã€Œå€‹åˆ¥ã®æ•™è‚²æ”¯æ´è¨ˆç”»ã€ï¼‰ã«ã‚ã‚‹æ›¸ãæ–¹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
- ã“ã®å¾Œã€ã“ã®ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ã‚’ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€â‡’ã€Œæ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ã€åŠã³ã€Œå„ç›®æ¨™ã«é€£å‹•ã—ãŸæ”¯æ´å†…å®¹ã€â‡’ã€ŒæŒ‡å°æ–¹é‡ã€ï¼ˆãƒ—ãƒ©ãƒ³Bã‚„å€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ï¼‰ã®é †ã§å…·ä½“åŒ–ã—ã¦ã„ãã®ã§ãã®ã¤ã‚‚ã‚Šã§æŠ½è±¡çš„ã«è¡¨ç¾ã™ã‚‹ã€‚
- ã€Œï½ã§ã™ã€‚ï½ã¾ã™ã€‚ã€èª¿ã§ã¯ãªãã€ã€Œï½ã§ã‚ã‚‹ã€‚ã€èª¿ã§æ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- å„é …ç›®ã®æ–‡é‡ã¯200ã€œ300æ–‡å­—ç¨‹åº¦ã§ã€æŸ”ã‚‰ã‹ãæ•™è‚²çš„ãªè¡¨ç¾ã§æ•´ãˆã¦ãã ã•ã„ã€‚
`;

    if (mode === "excel") {
      setP1Output(`ä»¥ä¸‹ã®å®Ÿæ…‹ã‚„èª²é¡Œã‚’ã‚‚ã¨ã«ã€ç‰¹åˆ¥æ”¯æ´æ•™è‚²ã«é–¢ã™ã‚‹ã€Œãƒ—ãƒ©ãƒ³Aã€ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ãŸã ã—ã€å‡ºåŠ›å½¢å¼ã¯æŒ‡å®šã®ã€JSONå½¢å¼ã€‘ã®ã¿ã¨ã—ã¾ã™ã€‚å‰ç½®ãã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚

ã€å…¥åŠ›ã€‘å®Ÿæ…‹ã‚„èª²é¡Œï¼š
${p1Input}

${commonInstructions}

ã€é‡è¦ï¼šå‡ºåŠ›å½¢å¼ã¨æ•´å½¢ãƒ«ãƒ¼ãƒ«ã€‘
ä¸Šè¨˜ã®å†…å®¹ã‚’ä½œæˆã—ãŸä¸Šã§ã€ä»¥ä¸‹ã®JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ ¼ç´ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
JSONã®valueï¼ˆå€¤ï¼‰ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å³å®ˆã—ã¦ãã ã•ã„ã€‚

1. **ã‚¿ã‚¤ãƒˆãƒ«ã®é™¤å¤–**ï¼š
   Excelã®ã‚»ãƒ«ã«æ—¢ã«ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã‚ã‚‹ãŸã‚ã€å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆã«ã¯ã€Œ1.ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ã‚„ã€Œ2.åˆç†çš„é…æ…®ã®å®Ÿæ–½å†…å®¹ã€ã¨ã„ã£ãŸ**ã‚¿ã‚¤ãƒˆãƒ«è¡Œã‚’å«ã‚ãªã„ã§ãã ã•ã„**ã€‚ä¸­èº«ã®æ–‡ç« ã®ã¿ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

2. **æ”¹è¡Œã®å³å®ˆ**ï¼š
   Excelã®ã‚»ãƒ«å†…ã§è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ç®‡æ‰€ã®ç›´å‰ã«ã¯**å¿…ãšæ”¹è¡Œ**ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚
   - ã€Œâ‘ ã€ã€Œâ‘¡ã€ã€Œâ‘¢ã€ãªã©ã®ç•ªå·ã®ç›´å‰
   - ã€Œãƒ»ã€ãªã©ã®ç®‡æ¡æ›¸ãè¨˜å·ã®ç›´å‰
   - ã€Œå¾“ã£ã¦ã€ã€ã€Œæ”¯æ´ã«å½“ãŸã£ã¦ã¯ã€ã€ãªã©ã®æ®µè½ã®å¤‰ã‚ã‚Šç›®ã®ç›´å‰
   
3. **ä½™è¨ˆãªè¨˜å·ã®ç¦æ­¢**ï¼š
   - Geminiç­‰ã§è¡¨ç¤ºã•ã‚Œã‚‹**ã€Œ**ã€ï¼ˆå¤ªå­—å¼·èª¿ï¼‰ãªã©ã®Markdownè¨˜å·ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**ã€‚ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã«ã—ã¦ãã ã•ã„ã€‚

ã€JSONå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
{
  "needs": "ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã®å†…å®¹ã®ã¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä¸è¦ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰",
  "accommodations": "åˆç†çš„é…æ…®ã®å®Ÿæ–½å†…å®¹ã®ã¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä¸è¦ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰"
}`);
    } else {
      setP1Output(`ä»¥ä¸‹ã®å®Ÿæ…‹ã‚„èª²é¡Œã‚’ã‚‚ã¨ã«ã€ç‰¹åˆ¥æ”¯æ´æ•™è‚²ã«é–¢ã™ã‚‹ã€Œãƒ—ãƒ©ãƒ³Aã€ã®ä»¥ä¸‹ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€å…¥åŠ›ã€‘å®Ÿæ…‹ã‚„èª²é¡Œï¼š
${p1Input}
${commonInstructions}`);
    }
  };

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡
  const generatePrompt2 = () => {
    const commonInstructions = `
ã€å‡ºåŠ›é …ç›®ã€‘ï¼š
ãƒ»1æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ãƒ»æ©Ÿé–¢åã€2æ”¯æ´å†…å®¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã€€â€»æ©Ÿé–¢åã¯ãã†ã„ã†è¡¨è¨˜ãŒã•ã‚Œã¦ã„ã‚‹ã ã‘ã§ã€æ„å‘³ã¯ç„¡è¦–ã—ã¦è‰¯ã„ã‚¿ã‚¤ãƒˆãƒ«ã¯ãã®ã¾ã¾ã§ã€‚
1.æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ãƒ»æ©Ÿé–¢å  
ï¼ˆç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã®â‘ ï½â‘¢ã«å¯¾å¿œã—ã¦ä½œæˆã€‚â‘¡ã¾ã§ã—ã‹ãªã„å ´åˆã¯â‘¡ã¾ã§ã§ã‚ˆã„ã€‚ï¼‰

â‘ ç›®æ¨™ï¼šï¼ˆ30å­—ä»¥å†…ç¨‹åº¦ãƒ»çŸ­ãã¦ã‚‚ã‚ˆã„ï¼‰  
â‘¡ç›®æ¨™ï¼šï¼ˆ30å­—ä»¥å†…ç¨‹åº¦ãƒ»çŸ­ãã¦ã‚‚ã‚ˆã„ï¼‰    
â‘¢ç›®æ¨™ï¼šï¼ˆ30å­—ä»¥å†…ç¨‹åº¦ãƒ»çŸ­ãã¦ã‚‚ã‚ˆã„ï¼‰  

2.æ”¯æ´å†…å®¹  
ï¼ˆä¸Šè¨˜ã®â‘ ï½â‘¢ã®ç›®æ¨™ãã‚Œãã‚Œã«å¯¾å¿œã—ã¦ä½œæˆã€‚ï¼‰

â‘ ï¼ˆ50å­—ä»¥å†…ç¨‹åº¦ã§ã€å­¦æ ¡ç¾å ´ã§å®Ÿè·µå¯èƒ½ãªæ”¯æ´å†…å®¹ã‚’è¨˜è¼‰ï¼‰  
â‘¡ï¼ˆ50å­—ä»¥å†…ç¨‹åº¦ã§ã€å­¦æ ¡ç¾å ´ã§å®Ÿè·µå¯èƒ½ãªæ”¯æ´å†…å®¹ã‚’è¨˜è¼‰ï¼‰  
â‘¢ï¼ˆ50å­—ä»¥å†…ç¨‹åº¦ã§ã€å­¦æ ¡ç¾å ´ã§å®Ÿè·µå¯èƒ½ãªæ”¯æ´å†…å®¹ã‚’è¨˜è¼‰ï¼‰

ã€æ¡ä»¶ã€‘ï¼š
- ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ã¨å¯¾å¿œãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«â‘ ï½â‘¢ã®ç•ªå·ã‚’æƒãˆã‚‹ã“ã¨ã€‚  
- å„æ–‡ã¯çŸ­ãã¦ã‚‚ã‚ˆã„ãŒã€æ•™è‚²çš„ã§æŸ”ã‚‰ã‹ã„è¡¨ç¾ã«ã™ã‚‹ã“ã¨ã€‚  
- ã€Œï½ã§ã™ã€‚ï½ã¾ã™ã€‚ã€èª¿ã§ã¯ãªãã€ã€Œï½ã§ã‚ã‚‹ã€‚ã€èª¿ã§çµ±ä¸€ã™ã‚‹ã“ã¨ã€‚  
- æ·»ä»˜è³‡æ–™ï¼ˆã€Œãƒ—ãƒ©ãƒ³Aã€ã‚„ã€Œå€‹åˆ¥ã®æ•™è‚²æ”¯æ´è¨ˆç”»ã€ï¼‰ã®æ›¸ãæ–¹ã‚’å‚è€ƒã«ã—ã¦ã‚ˆã„ã€‚  
- ã“ã“ã§ã¯æŠ½è±¡çš„ã«ã¾ã¨ã‚ã€**æ¬¡ã®æ®µéšï¼ˆãƒ—ãƒ©ãƒ³Bãªã©ï¼‰ã§å…·ä½“åŒ–ã—ã¦ã„ããŸã‚ã®åŸºç¤**ã¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ã€‚  
`;

    if (mode === "excel") {
      setP2Output(`ä»¥ä¸‹ã®ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ã«åŸºã¥ã„ã¦ã€ã€Œæ‰€å±æ ¡ã«ã‚ˆã‚‹æ”¯æ´è¨ˆç”»ï¼ˆãƒ—ãƒ©ãƒ³Aï¼‰ã€ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ãŸã ã—ã€å‡ºåŠ›å½¢å¼ã¯æŒ‡å®šã®ã€JSONå½¢å¼ã€‘ã®ã¿ã¨ã—ã¾ã™ã€‚å‰ç½®ãã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚

ã€å‚è€ƒã€‘ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºï¼š
${p2Input}

${commonInstructions}

ã€é‡è¦ï¼šå‡ºåŠ›å½¢å¼ã¨æ•´å½¢ãƒ«ãƒ¼ãƒ«ã€‘
ä¸Šè¨˜ã®å†…å®¹ã‚’ä½œæˆã—ãŸä¸Šã§ã€ä»¥ä¸‹ã®JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ ¼ç´ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
JSONã®valueï¼ˆå€¤ï¼‰ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å³å®ˆã—ã¦ãã ã•ã„ã€‚

1. **ã‚¿ã‚¤ãƒˆãƒ«ã®é™¤å¤–**ï¼š
   ã€Œ1.æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ãƒ»æ©Ÿé–¢åã€ã‚„ã€Œ2.æ”¯æ´å†…å®¹ã€ã¨ã„ã£ãŸ**ã‚¿ã‚¤ãƒˆãƒ«è¡Œã‚’å«ã‚ãªã„ã§ãã ã•ã„**ã€‚
   
2. **æ”¹è¡Œã®å³å®ˆ**ï¼š
   Excelã®ã‚»ãƒ«å†…ã§è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã€ã€Œâ‘ ã€ã€Œâ‘¡ã€ã€Œâ‘¢ã€ãªã©ã®ç•ªå·ã®ç›´å‰ã«ã¯**å¿…ãšæ”¹è¡Œ**ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚
   
3. **ä½™è¨ˆãªè¨˜å·ã®ç¦æ­¢**ï¼š
   - **ã€Œ**ã€ï¼ˆå¤ªå­—å¼·èª¿ï¼‰ãªã©ã®Markdownè¨˜å·ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**ã€‚

ã€JSONå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
{
  "goals": "æ”¯æ´ç›®æ¨™ã®å†…å®¹ã®ã¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä¸è¦ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰",
  "support": "æ”¯æ´å†…å®¹ã®å†…å®¹ã®ã¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä¸è¦ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰"
}`);
    } else {
      setP2Output(`ä»¥ä¸‹ã®ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ã«åŸºã¥ã„ã¦ã€ã€Œæ‰€å±æ ¡ã«ã‚ˆã‚‹æ”¯æ´è¨ˆç”»ï¼ˆãƒ—ãƒ©ãƒ³Aï¼‰ã€ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€å‚è€ƒã€‘ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºï¼š
${p2Input}
${commonInstructions}`);
    }
  };

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢
  const generatePrompt3 = () => {
    const commonInstructions = `
ã€å‡ºåŠ›é …ç›®ã€‘

1.æŒ‡å°æ–¹é‡
ãƒ»ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºâ‘ ï½â‘¢ã€ã¨ã€Œæ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™â‘ ï½â‘¢ã€ã‚’è¸ã¾ãˆã€ã‚ˆã‚Šå…·ä½“çš„ãªæŒ‡å°ã®æ–¹å‘æ€§ã‚’ç¤ºã™ã€‚
ãƒ»å…ç«¥ç”Ÿå¾’ã®å®Ÿæ…‹ã‚’å†’é ­ã§ä¸å¯§ã«æå†™ã—ã€ãã®å¾Œã«å¿…è¦ãªæŒ‡å°å†…å®¹ã‚’â‘ ï½â‘¢ã«æ•´ç†ã™ã‚‹ã€‚
ãƒ»å…¨ä½“ã‚’é€šã—ã¦300ã€œ500å­—ç¨‹åº¦ã¨ã—ã€æ•™è‚²çš„ã§æŸ”ã‚‰ã‹ã„è¡¨ç¾ã‚’ç”¨ã„ã‚‹ã€‚
ãƒ»æ–‡ç« ãŒé•·ããªã‚‹å ´åˆã¯è¤‡æ•°å›ã«åˆ†ã‘ã¦å‡ºåŠ›ã—ã¦ã‚ˆã„ã€‚

2.å®Ÿæ…‹ï¼ˆç‰¹åˆ¥æ”¯æ´ã«ãŠã‘ã‚‹7åŒºåˆ†ã€”ç®‡æ¡æ›¸ãã§ã€ä¾‹ï¼šã€ç€æ›¿ãˆã€‘ãƒ»ï½ã®å½¢ã€•ï¼‰
ãƒ»ä»¥ä¸‹ã®åŒºåˆ†ã”ã¨ã«é …ç›®ã‚’ã‚‚ã†ã‘ã¦ï¼ˆå†…å®¹ã«ã‚ˆã£ã¦é …ç›®ã®æ•°ã«åã‚ŠãŒã‚ã£ã¦ã‚‚ã‚ˆã„ï¼‰è¨˜è¿°ã™ã‚‹ã€‚å„åŒºåˆ†ã«ä¾‹ã‚’è¨­ã‘ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„
â‘  å¥åº·ã®ä¿æŒï¼ˆæ—¥å¸¸ç”Ÿæ´»é¢ã€å¥åº·é¢ãªã©ï¼‰ã€ç€æ›¿ãˆã€‘ã€é£Ÿäº‹ã€‘ã€æ’æ³„ã€‘ã€å¥åº·ä¸Šã®é…æ…®ã€‘
ï¼ˆã“ã®åŒºåˆ†ã¯å¤šã‚ã«é …ç›®ã‚’è¨­ã‘ã‚‹ã€ä¾‹ï¼šã€ç€æ›¿ãˆã€‘ãƒ»ã‚ºãƒœãƒ³ã«ã¯ãƒ¯ãƒƒãƒšãƒ³ã‚’ã¤ã‘ã‚‹ã¨å‰å¾ŒãŒã‚ã‹ã£ã¦å±¥ãã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»è¨€è‘‰ã‹ã‘ã‚’å—ã‘ã¦è„±ã„ã æœã®è£è¿”ã—ã‚’ç›´ã™ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»ç™»æ ¡æ™‚ã¯ã‚ªãƒ ãƒ„ã‚’ç€ç”¨ã—ã¦ã„ã‚‹ã€‚ç™»æ ¡å¾Œã«å¸ƒãƒ‘ãƒ³ãƒ„ã«å±¥ãæ›¿ãˆã¦ã„ã‚‹ã€‚ãƒ»ä¸‹æ ¡æ™‚ã¯å¸ƒãƒ‘ãƒ³ãƒ„ã‚’ä½¿ç”¨ã™ã‚‹ã€‚ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã‚Šå¸°ã‚Šéš›ã«ãƒˆã‚¤ãƒ¬ã«è¡Œã‹ã›ã‚‹ã€‚ã€é£Ÿäº‹ã€‘ãƒ»é£Ÿäº‹ã¯å°‘é‡ãšã¤åˆ¥çš¿ã«å…¥ã‚Œã¦æä¾›ã—ã¦ã„ã‚‹ã€‚ã¾ãŸã€å·¦æ‰‹ã‚’ãŠæ¤€ã«æ·»ãˆã¦ã€å³æ‰‹ã§ã‚¹ãƒ—ãƒ¼ãƒ³ã‚„è£œåŠ©å…·ä»˜ãã®ç®¸ã‚’ä½¿ç”¨ã—ã¦é£Ÿã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ã€æ’æ³„ã€‘ãƒ»ç«‹ã¡ä¾¿å™¨ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚ã€å¥åº·ä¸Šã®é…æ…®ã€‘ãƒ»æ˜¥ã¯èŠ±ç²‰ç—‡ã®è–¬ã‚’æœç”¨ã—ã¦ã„ã‚‹ã€‚ãªã©ã€‘ï¼‰
â‘¡ å¿ƒç†çš„ãªå®‰å®šï¼ˆæƒ…ç·’é¢ã€çŠ¶æ³ã®ç†è§£ãªã©ï¼‰ã€è‹¦æ‰‹ãªçŠ¶æ³ã€‘
ã€ä¾‹ï¼šã€è‹¦æ‰‹ãªçŠ¶æ³ã€‘ãƒ»æ€¥ãªéŸ³ã‚„å¤§ããªéŸ³ã¯è‹¦æ‰‹ã§ã€é©šã„ã¦ä¸å®‰å®šã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚ãƒ»æ°—æŒã¡ãŒä¸å®‰å®šãªæ™‚ã¯ã€é¦–ã«æ´ã¿ã‹ã‹ã‚ã†ã¨ã—ãŸã‚Šã€å™›ã‚‚ã†ã¨ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚ãƒ»æš‘ã„å­£ç¯€ã¯è‹¦æ‰‹ã§ã€å¤å ´ã¯æ°—æŒã¡ãŒä¸å®‰å®šã«ãªã‚‹ã“ã¨ãŒå¤šã„ã€‚æ±—ã‚’æ‹­ãã“ã¨ã«ã‚ˆã‚Šæ°—æŒã¡ãŒè½ã¡ç€ãã“ã¨ãŒã‚ã‚‹ã€‚ãƒ»æ°—æŒã¡ãŒä¸å®‰å®šãªæ™‚ã«ã€ã‚¤ãƒ¤ãƒ¼ãƒãƒ•ã‚’ç€ç”¨ã—ã¦ã„ã‚‹ã€‚ãƒ»æ°—æŒã¡ãŒä¸å®‰å®šãªã¨ãã«æ·±å‘¼å¸ã‚’ä¿ƒã—ãŸã‚Šã€æ•™å“¡ãŒèƒ¸ã‚„èƒŒä¸­ã‚’ãƒˆãƒ³ãƒˆãƒ³å©ã„ãŸã‚Šã™ã‚‹ã¨è½ã¡ç€ãã“ã¨ãŒã‚ã‚‹ã€‚ï¼ˆæ„Ÿè¦šçµ±åˆã€å‰¯äº¤æ„Ÿç¥çµŒï¼‰ã€ãã®ä»–ã€‘ãƒ»æ­©ã„ãŸã‚Šã€èº«ä½“ã‚’å‹•ã‹ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¥½ãã§ã€æ•£æ­©ã‚’ã™ã‚‹ã“ã¨ã§æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚ãƒ»è¦‹é€šã—ã®æŒã¡ã‚„ã™ã„èª²é¡Œã«ã¯ï¼“ï¼åˆ†ç¨‹åº¦é›¢å¸­ã›ãšã«å–ã‚Šçµ„ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»è¦‹é€šã—ã®æŒã¡ã«ãã„å ´é¢ã‚„ã€æ°—æŒã¡ãŒå‘ã‹ãªã„æ´»å‹•ã®æ™‚ã«ã¯ãƒˆã‚¤ãƒ¬ã«è¡Œã“ã†ã¨ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚ãƒ»æ€’ã‚‹ã¨è¿‘ãã«ã‚ã‚‹ç‰©ã‚’å™›ã‚€ç™–ãŒã‚ã‚‹ã€‚(ã‹ãªã‚Šæ¸›ã£ã¦ããŸ)ã€‘
â‘¢ äººé–“é–¢ä¿‚ã®å½¢æˆï¼ˆäººã¨ã®ã‹ã‹ã‚ã‚Šã€é›†å›£ã¸ã®å‚åŠ ãªã©ï¼‰ã€å¤§äººã‚„å‹é”ã¨ã®é–¢ã‚ã‚Šã€‘ã€é›†å›£å‚åŠ ã€‘
ã€ä¾‹ï¼šã€å¤§äººã‚„å‹é”ã¨ã®é–¢ã‚ã‚Šã€‘ãƒ»æ•™å“¡ã‹ã‚‰ã®å‘¼ã³ã‹ã‘ã«åå¿œã—ã€è¡Œå‹•ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»èº«è¿‘ãªå¤§äººã®è†ã®ä¸Šã«ä¹—ã‚ã†ã¨ã—ãŸã‚Šã€æŠ±ãç€ã“ã†ã¨ã—ãŸã‚Šã™ã‚‹ãªã©ã®èº«ä½“ãƒ»æ¥è§¦ãŒå¥½ãã§ã‚ã‚‹ã€‚ã€é›†å›£å‚åŠ ã€‘ãƒ»èª°ã¨ã§ã‚‚æ‰‹ã‚’ç¹‹ã„ã ã‚Šã€é–¢ã‚ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ã€‘
â‘£ ç’°å¢ƒã®æŠŠæ¡ï¼ˆæ„Ÿè¦šã®æ´»ç”¨ã€èªçŸ¥é¢ã€å­¦ç¿’é¢ãªã©ï¼‰ã€å­¦ç¿’ã®æ§˜å­ã€‘
ã€ä¾‹ï¼šã€å­¦ç¿’ã®æ§˜å­ã€‘ãƒ»ã‚·ãƒ¼ãƒ«ã‚’è‡ªåˆ†ã§å¥½ããªã‚ˆã†ã«è²¼ã‚Œã‚‹ã€‚ä¸¸ã„ç´™ã‚„ã‚¿ã‚¤ãƒ«ã‚’ä¸€ç›´ç·šã«è²¼ã‚Œã‚‹ã€‚ãƒ»è‰²ã®åŒºåˆ¥ãŒã§ãã‚‹ã€‚ãƒ»ï¼“ï¼é¢ã¾ã§ã®ãƒ‘ã‚ºãƒ«ãŒã§ãã‚‹ã€‚ãƒ»ã²ã‚‰ãŒãªã‚„ã‚¤ãƒ©ã‚¹ãƒˆã®ãƒãƒƒãƒãƒ³ã‚°ãŒã§ãã‚‹ã€‚ã€‘
â‘¤ èº«ä½“ã®å‹•ãï¼ˆé‹å‹•ãƒ»å‹•ä½œã€ä½œæ¥­é¢ãªã©ï¼‰ã€èº«ä½“ã®å‹•ãã€‘ã€æ‰‹æŒ‡ã®æ“ä½œã€‘
ã€ä¾‹ï¼šã€èº«ä½“ã®å‹•ãã€‘ãƒ»éŸ³æ¥½ãŒå¥½ãã§ã€è´ããªãŒã‚‰èº«ä½“ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»ãƒ–ãƒ©ãƒ³ã‚³ã«ä¸€äººã§ä¹—ã‚Œã‚‹ã€‚ãƒ»ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚æ”¯æ´ã‚’å—ã‘ã¦ãƒœãƒ¼ãƒ«ã‚’è¹´ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ã€æ‰‹æŒ‡ã®æ“ä½œã€‘ãƒ»åˆ©ãæ‰‹ãŒã¾ã å®šã¾ã£ã¦ã„ãªã„ãŒã€å³æ‰‹ã‚’æ—¥å¸¸çš„ã«ä½¿ç”¨ã™ã‚‹ã€‚ãƒ»æ”¯æ´ã‚’å—ã‘ã¦ãƒã‚µãƒŸã‚„ã®ã‚Šãªã©ã®é“å…·ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»ç²—å¤§æ¨¡å€£ã¯ã€æ•™å“¡ã®æ‰‹æœ¬ã‚„æ˜ åƒã‚’è¦³ãŸã‚Šã—ãªãŒã‚‰è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»ã¤ã¾ã‚€ã€ã²ã­ã‚‹ã€å›ã™ã€æŠ¼ã™ãªã©æ‰‹æŒ‡ã‚’ä½¿ã£ãŸæ´»å‹•ãŒã§ãã‚‹ã€‚ãƒ»çˆªãŒãªã„ãŸã‚å¾®ç´°ãªå‹•ãã¯è‹¦æ‰‹ã§ã‚ã‚‹ã€‚ãƒ»è‡ªåŠ©ç®¸ã‚’ä½¿ç”¨ã—ã¦é£Ÿäº‹ãŒå–ã‚Œã‚‹ã€‚ã€‘
â‘¥ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ„æ€ã®ä¼é”ã€è¨€èªã®å½¢æˆãªã©ï¼‰ã€ï½ºï¾ï½­ï¾†ï½¹ï½°ï½¼ï½®ï¾ã®ç†è§£ã€‘ã€ï½ºï¾ï½­ï¾†ï½¹ï½°ï½¼ï½®ï¾ã®è¡¨å‡ºã€‘
ã€ä¾‹ï¼šã€ï½ºï¾ï½­ï¾†ï½¹ï½°ï½¼ï½®ï¾ã®ç†è§£ã€‘ãƒ»æ•™å“¡ã®æŒ‡ç¤ºã‚’ã‚ã‚‹ç¨‹åº¦ç†è§£ã—ã¦ã„ã¦ã€æŒ‡ç¤ºé€šã‚Šå‹•ãã“ã¨ãŒã§ãã‚‹ã€‚ã€ï½ºï¾ï½­ï¾†ï½¹ï½°ï½¼ï½®ï¾ã®è¡¨å‡ºã€‘ãƒ»ä¿ƒã•ã‚Œã‚‹ã¨ï½¤ã€Œã¡ã‚‡ã†ã ã„ã€ã®ã‚µã‚¤ãƒ³ã‚’å‡ºã™ã“ã¨ãŒã§ãã‚‹ã€‚ã‚µã‚¤ãƒ³ã¨ä¸€ç·’ã«ãƒ»å£ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ã€‚ã‚µã‚¤ãƒ³ã‚’å‡ºã—ã¦ã„ã‚‹å¤§äººã«ç‰©ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»æ•™å“¡ã‚’å‘¼ã¶ã¨ãã«ã€è‚©ã‚’ãƒˆãƒ³ãƒˆãƒ³ã¨å©ãã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»ã€Œãƒˆã‚¤ãƒ¬ã€ã€Œã”ã‚ã‚“ã€ãªã©ç°¡å˜ãªè¨€è‘‰ã®ç™ºèªãŒã§ãã‚‹ã€‚ãƒ»æ’æ³„ã®æ„æ€è¡¨ç¤ºã¯ã€Œãƒˆã‚¤ãƒ¬ã€ã¨ä¼ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»å£å½¢æ¨¡å€£ã‚„å˜éŸ³ã®ç™ºå£°ã¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¦ã„ã‚‹ã€‚ã€‘
â‘¦ ãã®ä»–ï¼ˆæ€§æ ¼ã€è¡Œå‹•ç‰¹å¾´ã€èˆˆå‘³é–¢å¿ƒãªã©ï¼‰ã€èˆˆå‘³é–¢å¿ƒã€‘
ã€ä¾‹ï¼šã€èˆˆå‘³é–¢å¿ƒã€‘ãƒ»æ´»å‹•ä¸­ã«èº«ä½“ã‚’å¤§ããå·¦å³ã«å‹•ã‹ã—ãŸã‚Šé£›ã³è·³ã­ãŸã‚Šã™ã‚‹ã¨ããŒã‚ã‚‹ã€‚ãƒ»ãŠã‚‚ã¡ã‚ƒã‚’åºŠã«ãŸãŸãã¤ã‘ã‚‹ã‚ˆã†ã«æŠ•ã’ã‚‹ã€‚ã€‘
ãƒ»ã€å…¥åŠ›ã€‘ã®å®Ÿæ…‹ãƒ»èª²é¡Œã‚’ã‚‚ã¨ã«ã€å¯èƒ½ãªé™ã‚Šå¤šãã®å…·ä½“çš„å†…å®¹ã‚’ç››ã‚Šè¾¼ã‚€ã€‚
ãƒ»1å›ã§æ›¸ããã‚Œãªã„å ´åˆã¯ã€ä½•å›ã«ãªã£ã¦ã‚‚ã‚ˆã„ã®ã§ã€è¤‡æ•°å›ã«åˆ†ã‘ã¦å‡ºåŠ›ã™ã‚‹ã€‚

ã€æ¡ä»¶ã€‘ï¼š
- æ·»ä»˜è³‡æ–™ãŒã‚ã‚Œã°å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼ˆãƒ—ãƒ©ãƒ³Bã‚„å€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ï¼‰ã€‚
- ã€Œï½ã§ã™ã€‚ï½ã¾ã™ã€‚ã€èª¿ã§ã¯ãªãã€ã€Œï½ã§ã‚ã‚‹ã€‚ã€èª¿ã§æ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- ã€å…¥åŠ›ã€‘ã®å†…å®¹ã ã‘ã§ãªãã€ã“ã‚Œã¾ã§ã®ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã¨æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ã‹ã‚‰ç™ºå±•ã•ã›ã¦ä½œæˆã™ã‚‹ã€‚
- ã€Œ1.æŒ‡å°æ–¹é‡ã€ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã¨æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ã‚ˆã‚Šå…·ä½“çš„ãªå†…å®¹ã«ã™ã‚‹
- ã€Œ1.æŒ‡å°æ–¹é‡ã€ã¯ç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã¨æ‰€å±æ ¡ã®æ”¯æ´ç›®æ¨™ã®â‘ ï½â‘¢ã«é€£å‹•ã—ãŸå½¢ã§ï¼ˆâ‘¡ã¾ã§ã—ã‹ãªã„å ´åˆã¯åŒæ§˜ã«â‘ ã€â‘¡ã§OKï¼‰
- â‘  æŒ‡å°æ–¹é‡ã®ä¾‹ï¼šã€Œç¾åœ¨ã€æœ¬ç”Ÿå¾’ã¯ã€å³ç›®ã®è¦–åŠ›ãŒç„¡ãå·¦ç›®ã‚‚è¦–åŠ›ãŒå¼±ãè¦–é‡ãŒç‹­ã„ã€‚ã¾ãŸã€è´åŠ›ã¯ã€å…¨ãèã“ãˆã¦ã„ãªã„ã¨æ€ã‚ã‚Œã€æ—¥å¸¸ç”Ÿæ´»ã®æ®†ã©ã‚’æ•™å“¡ã«ä»»ã›ãã‚Šã«ã—ã¦ã„ãŸã‚Šã€æ•™å“¡ã«å¯¾ã—ã¦å¸¸ã«è§¦ã‚Œåˆã„ãƒ»æºã•ã¶ã‚Šãªã©ã®åˆºæ¿€ã‚’æ±‚ã‚ã¦ã„ã‚‹ã€‚ã¾ãŸã€ä¸é©åˆ‡ãªè¡Œå‹•ãŒå¤šãè¦‹ã‚‰ã‚Œã€åˆºæ¿€ã‚’æ±‚ã‚ã¦ã€è‡ªåˆ†ã®é¡”ã«å”¾ã‚„æ°´ãƒ»ãŠã—ã£ã“ã‚’ã‹ã‘ãŸã‚Šã€å¹ãå‡ºã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚„ç‰©ã‚’æŠ•ã’ãŸã‚Šã€å€’ã—ãŸã‚Šè¡å‹•çš„ãªè¡Œå‹•ã€äººã¨ã®ã‹ã‹ã‚ã‚Šã®ä¸­ã§æŠ“ã£ãŸã‚Šã€å©ã„ãŸã‚Šã€é«ªã®æ¯›ã‚’å¼•ã£å¼µã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚ã‚³ãƒŸãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒ³é¢ã§ã¯ã€æ‰‹è©±ã«ã‚ˆã‚‹ã‚µã‚¤ãƒ³ãŒï¼’ï½ï¼“å€‹ç†è§£ã§ãã‚‹ã€‚ã¾ãŸã€è‡ªåˆ†ã§1å€‹ã€Œãƒˆã‚¤ãƒ¬ã€ã®ã‚µã‚¤ãƒ³ã‚’è¡Œã†æ™‚ãŒã‚ã‚‹ã€‚ãã®ä»–ã€ç›¸æ‰‹ã®æ‰‹ã‚’å–ã‚Šç›´æ¥æ‰‹ã‚’å‹•ã‹ã—ã¦ã®è¦æ±‚ã‚’ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚
å¾“ã£ã¦ã€ä»¥ä¸‹ã®â‘ ï½â‘¢ã®æŒ‡å°ãŒå¿…è¦ã ã¨è€ƒãˆã‚‹ã€‚
ã€€â‘ ãƒˆã‚¤ãƒ¬ã‚„é£Ÿäº‹ã€ç€æ›¿ãˆãªã©æ—¥å¸¸ç”Ÿæ´»ã®ä¸­ã§ã€æ•™å“¡ã«é ¼ã‚‰ãšã«ã²ã¨ã‚Šã§ã§ãã‚‹ã“ã¨ã‚’å¢—ã‚„ã™ã€‚
ã€€â‘¡ä¸é©åˆ‡è¡Œå‹•ãŒèµ·ããŸæ™‚ã«ç¹°ã‚Šè¿”ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚
ã€€â‘¢çµµã‚«ãƒ¼ãƒ‰ã‚„æ‰‹è©±ã«ã‚ˆã‚‹è¦æ±‚ã‚’å¢—ã‚„ã™ã€‚
ã“ã‚Œã‚‰ã®æŒ‡å°ã‚’å…ƒã«æœ¬ç”Ÿå¾’ã®ç”Ÿæ´»é¢ã§ã®è‡ªç«‹ã€è¡Œå‹•é¢ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³é¢ã§ã®æˆé•·ã«ã¤ãªã’ã¦ã„ãã€‚ã€
- 1å›ã§æ›¸ããã‚Œãªã„å ´åˆã¯ã€ä½•å›ã«ãªã£ã¦ã‚‚ã‚ˆã„ã®ã§ã€è¤‡æ•°å›ã«åˆ†ã‘ã¦å‡ºåŠ›ã™ã‚‹ã€‚
- æŒ‡å°æ–¹é‡ã¯å…¨ä½“çš„ãªè¦–ç‚¹ã§ã€å„å®Ÿæ…‹ã¯200ã€œ300æ–‡å­—ã§ä¸å¯§ã«æå†™ã—ã¦ãã ã•ã„ã€‚
- **æ”¹è¡Œã®å³å®ˆ**ï¼š
   Excelã®ã‚»ãƒ«å†…ã§è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã€ã€Œãƒ»ã€ãªã©ã®ç›´å‰ã«ã¯**å¿…ãšæ”¹è¡Œ**ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚  
- **ä½™è¨ˆãªè¨˜å·ã®ç¦æ­¢**ï¼š
   - **ã€Œ**ã€ï¼ˆå¤ªå­—å¼·èª¿ï¼‰ãªã©ã®Markdownè¨˜å·ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**
`;

    if (mode === "excel") {
      setP3Output(`ä»¥ä¸‹ã®å®Ÿæ…‹ãƒ»èª²é¡Œã‚’ã‚‚ã¨ã«ã€ç‰¹åˆ¥æ”¯æ´è¨ˆç”»ã€Œãƒ—ãƒ©ãƒ³Bã€ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ãŸã ã—ã€å‡ºåŠ›å½¢å¼ã¯æŒ‡å®šã®ã€JSONå½¢å¼ã€‘ã®ã¿ã¨ã—ã¾ã™ã€‚å‰ç½®ãã‚„è§£èª¬ã¯ä¸è¦ã§ã™ã€‚

ã€å…¥åŠ›ã€‘å®Ÿæ…‹ãƒ»èª²é¡Œï¼š
${p3Input}

${commonInstructions}

ã€é‡è¦ï¼šå‡ºåŠ›å½¢å¼ã¨æ•´å½¢ãƒ«ãƒ¼ãƒ«ã€‘
ä¸Šè¨˜ã®è©³ç´°ãªæŒ‡ç¤ºã«åŸºã¥ãå†…å®¹ã‚’ä½œæˆã—ãŸä¸Šã§ã€ä»¥ä¸‹ã®JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ ¼ç´ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
JSONã®valueï¼ˆå€¤ï¼‰ã¨ãªã‚‹æ–‡å­—åˆ—ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®æ•´å½¢ãƒ«ãƒ¼ãƒ«ã‚’å³å®ˆã—ã¦ãã ã•ã„ã€‚

1. **ã‚¿ã‚¤ãƒˆãƒ«ã®é™¤å¤–**ï¼š
   Excelã®ã‚»ãƒ«ã«æ—¢ã«ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã‚ã‚‹ãŸã‚ã€ã€Œ1.æŒ‡å°æ–¹é‡ã€ã‚„ã€Œâ‘  å¥åº·ã®ä¿æŒã€ã¨ã„ã£ãŸ**ã‚¿ã‚¤ãƒˆãƒ«ã‚„é …ç›®åã‚’å«ã‚ãªã„ã§ãã ã•ã„**ã€‚ãã®é …ç›®ã®å®Ÿæ…‹ï¼ˆå†…å®¹ï¼‰ã®ã¿ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

2. **æ”¹è¡Œã®å³å®ˆ**ï¼š
   Excelã®ã‚»ãƒ«å†…ã§è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã€ã€Œãƒ»ã€ã‚„ã€Œã€é …ç›®åã€‘ã€ã®ç›´å‰ã«ã¯**å¿…ãšæ”¹è¡Œ**ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚
   
3. **ä½™è¨ˆãªè¨˜å·ã®ç¦æ­¢**ï¼š
   - **ã€Œ**ã€ï¼ˆå¤ªå­—å¼·èª¿ï¼‰ãªã©ã®Markdownè¨˜å·ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**ã€‚

ã€JSONå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
{
  "policy": "æŒ‡å°æ–¹é‡ã®å†…å®¹ã®ã¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä¸è¦ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰",
  "status_1": "å¥åº·ã®ä¿æŒã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘  å¥åº·ã®ä¿æŒã€ã¯å«ã‚ãªã„ã€æ•´å½¢ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰",
  "status_2": "å¿ƒç†çš„ãªå®‰å®šã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘¡ å¿ƒç†çš„ãªå®‰å®šã€ã¯å«ã‚ãªã„ï¼‰",
  "status_3": "äººé–“é–¢ä¿‚ã®å½¢æˆã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘¢ äººé–“é–¢ä¿‚ã®å½¢æˆã€ã¯å«ã‚ãªã„ï¼‰",
  "status_4": "ç’°å¢ƒã®æŠŠæ¡ã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘£ ç’°å¢ƒã®æŠŠæ¡ã€ã¯å«ã‚ãªã„ï¼‰",
  "status_5": "èº«ä½“ã®å‹•ãã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘¤ èº«ä½“ã®å‹•ãã€ã¯å«ã‚ãªã„ï¼‰",
  "status_6": "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘¥ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¯å«ã‚ãªã„ï¼‰",
  "status_7": "ãã®ä»–ã®å®Ÿæ…‹ã®ã¿ï¼ˆã€Œâ‘¦ ãã®ä»–ã€ã¯å«ã‚ãªã„ï¼‰"
}`);
    } else {
      setP3Output(`ä»¥ä¸‹ã®å®Ÿæ…‹ãƒ»èª²é¡Œã‚’ã‚‚ã¨ã«ã€ç‰¹åˆ¥æ”¯æ´è¨ˆç”»ã€Œãƒ—ãƒ©ãƒ³Bã€ã®é …ç›®ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€å…¥åŠ›ã€‘å®Ÿæ…‹ãƒ»èª²é¡Œï¼š
${p3Input}
${commonInstructions}`);
    }
  };

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£
  const generatePrompt4 = () => {
    if (p4SelectedSubjects.length === 0) {
      alert("æ•™ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    const prompts = p4SelectedSubjects.map((subject) => {
      const numItems = (subject === "è‡ªç«‹æ´»å‹•" || subject === "æ—¥å¸¸ç”Ÿæ´»ã®æŒ‡å°") ? 3 : 2;
      const currentJittai = p4SubjectInputs[subject] || "ï¼ˆå…¥åŠ›ãªã—ï¼‰";

      return `
ä»¥ä¸‹ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€å€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ã«ãŠã‘ã‚‹ã€${subject}ã€‘ã®ç›®æ¨™ã¨æ‰‹ç«‹ã¦ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€å…¥åŠ›ã€‘
æ•™ç§‘ï¼š${subject}
æ•™ç§‘ã®å†…å®¹ï¼š${currentJittai}
å‚è€ƒæŒ‡å°æ–¹é‡ï¼š${p4Reference}

ã€å‡ºåŠ›é …ç›®ã€‘
1. ç›®æ¨™ï¼ˆ${numItems}ã¤ï¼‰ï¼š
   ãƒ»å„ç›®æ¨™ã¯30å­—ä»¥å†…ç¨‹åº¦ã§ã€ãŠå­ã•ã‚“ãŒé”æˆã™ã¹ãå…·ä½“çš„ãªè¡Œå‹•ã‚„çŠ¶æ…‹ã‚’ç¤ºã™ã“ã¨ã€‚
   ãƒ»æ•™è‚²çš„ã§æŸ”ã‚‰ã‹ã„è¡¨ç¾ã«ã™ã‚‹ã“ã¨ã€‚
   ãƒ»ã€Œï½ã§ãã‚‹ã€èª¿ã«ã™ã‚‹ã€‚
   ãƒ»æ•™ç§‘ãŒã€Œè‡ªç«‹æ´»å‹•ã€ã®å ´åˆã¯ã€ã€æ•™è‚²æ´»å‹•å…¨èˆ¬ã€‘ã¨ã€æ™‚é–“ã«ãŠã‘ã‚‹æŒ‡å°ã€‘ã®äºŒã¤ã‹ã‚‰ç›®æ¨™ã‚’ãã‚Œãã‚Œè¨­å®šã™ã‚‹ï¼ˆä¾‹ï¼šã€æ•™è‚²æ´»å‹•å…¨èˆ¬ã€‘è‡ªåˆ†ã®æ„è¦‹ã‚„è€ƒãˆã‚’ç›¸æ‰‹ã«æ­£ç¢ºã«ä¼ãˆã‚‹ã€‚ã€æ™‚é–“ã«ãŠã‘ã‚‹æŒ‡å°ã€‘ãƒ»å‹é”ã¨æ„æ€ã®ç–é€šã‚’å›³ã‚ŠãªãŒã‚‰è¨€è‘‰ã®ã‚„ã‚Šã¨ã‚Šã‚’ã—ãŸã‚Šã€ã‚²ãƒ¼ãƒ ã‚’ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»å‹ã ã¡ã¨å”åŠ›ã—ã¦æ´»å‹•ã«å–ã‚Šçµ„ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ»å™¨å…·ã‚’ä½¿ã£ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ãŸã‚Šå§¿å‹¢ã‚’ä¿æŒã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ï¼‰ã€‚
   ãƒ»å„æ•™ç§‘ã®ä¾‹ï¼ˆç¾è¡“ï¼šç›®æ¨™ã€Œãƒ»æ§˜ã€…ãªç´ æã‚„è‰²ã‹ã‚‰ã€å¥½ããªã‚‚ã®ã‚’é¸ã³ä½œå“ä½œã‚ŠãŒã§ãã‚‹ã€‚ãƒ»æ§˜ã€…ãªé“å…·ã‚’ä½¿ã£ã¦ä½œå“ä½œã‚ŠãŒã§ãã‚‹ã€‚ãƒ»é‘‘è³ã‚’é€šã—ã¦ã€è‡ªåˆ†ã®å¥½ããªä½œå“ã‚’é¸ã¶ã“ã¨ãŒã§ãã‚‹ã€‚ã€ï¼‰
   
2. æ‰‹ç«‹ã¦ï¼ˆ${numItems}ã¤ï¼‰ï¼š
   ãƒ»æ•™ç§‘ãŒã€Œè‡ªç«‹æ´»å‹•ã€ã®å ´åˆã¯ã€ã€æ•™è‚²æ´»å‹•å…¨èˆ¬ã€‘ã¨ã€æ™‚é–“ã«ãŠã‘ã‚‹æŒ‡å°ã€‘ã®äºŒã¤ã‹ã‚‰æ‰‹ç«‹ã¦ã‚’ãã‚Œãã‚Œç›®æ¨™ã«é€£å‹•ã™ã‚‹å½¢ã§è¨­å®šã™ã‚‹ï¼ˆä¾‹ï¼šã€æ•™è‚²æ´»å‹•å…¨èˆ¬ã€‘ãƒ»æ‰‹è©±ã‚„æ–‡å­—ã‚«ãƒ¼ãƒ‰ã‚„éŸ³å£°ã‚¢ãƒ—ãƒªã®æ´»ç”¨ã™ã‚‹ã€‚ã€æ™‚é–“ã«ãŠã‘ã‚‹æŒ‡å°ã€‘ãƒ»è¨€è‘‰ã§ã®ã‚„ã‚Šã¨ã‚Šãªã©ã§é©åˆ‡ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã§ããŸå ´åˆã«ç§°è³›ã™ã‚‹ã€‚ãƒ»è‰²ã€…ãªå‹é”ã¨æ´»å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ãƒ»æ„Ÿè¦šåˆºæ¿€ã«ã‚ˆã‚Šå”èª¿é‹å‹•ã®å‘ä¸Šã‚’ã¯ã‹ã‚‹ã€‚ï¼‰ã€‚
   ãƒ»å„æ‰‹ç«‹ã¦ã¯30å­—ã‹ã‚‰50å­—ç¨‹åº¦ã§ã€ç›®æ¨™é”æˆã®ãŸã‚ã«å­¦æ ¡ç¾å ´ã§å®Ÿè·µå¯èƒ½ãªå…·ä½“çš„ãªæ”¯æ´å†…å®¹ã‚„æ–¹æ³•ã‚’ç¤ºã™ã“ã¨ã€‚
   ãƒ»ãŠå­ã•ã‚“ã®å®Ÿæ…‹ã‚„èª²é¡Œã€æŒ‡å°æ–¹é‡ã‚’è€ƒæ…®ã—ã€å€‹åˆ¥å…·ä½“çš„ãªå†…å®¹ã«ã™ã‚‹ã“ã¨ã€‚
   ãƒ»æ–‡ã®æœ€å¾Œã¯ã€Œï½ã™ã‚‹ã€‚ã€ã€Œï½ã‚’ä¿ƒã™ã€ãªã©æ‰‹ç«‹ã¦ã«ç›¸å¿œã—ã„å½¢ã«ã™ã‚‹ã€‚
   ãƒ»å„æ•™ç§‘ã®ä¾‹ï¼ˆç¾è¡“ï¼šæ‰‹ç«‹ã¦ã€Œãƒ»æ§˜ã€…ãªç´ æã‚„é“å…·ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€ãã®ä¸­ã‹ã‚‰é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ãƒ»ä½¿ã„æ–¹ã®æ²ç¤ºã€æ•™å“¡ã¨ä¸€ç·’ã«ã¤ã‹ã£ãŸã‚Šã™ã‚‹ã€‚ãƒ»å‹é”ã®ä½œå“ã‚’åˆ†ã‹ã‚Šã‚„ã™ãä¸¦ã¹ã€å¥½ããªä½œå“ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ã€ï¼‰

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹ã€‘
ã€${subject}ã€‘
ç›®æ¨™ï¼š
ãƒ»ï¼ˆç›®æ¨™1ï¼š30å­—ä»¥å†…ï¼‰
ãƒ»ï¼ˆç›®æ¨™2ï¼š30å­—ä»¥å†…ï¼‰
${numItems === 3 ? "ãƒ»ï¼ˆç›®æ¨™3ï¼š30å­—ä»¥å†…ï¼‰" : ""}

æ‰‹ç«‹ã¦ï¼š
ãƒ»ï¼ˆæ‰‹ç«‹ã¦1ï¼š30ï½50å­—ï¼‰
ãƒ»ï¼ˆæ‰‹ç«‹ã¦2ï¼š30ï½50å­—ï¼‰
${numItems === 3 ? "ãƒ»ï¼ˆæ‰‹ç«‹ã¦3ï¼š30ï½50å­—ï¼‰" : ""}

ã€æ¡ä»¶ã€‘ï¼š
- æ·»ä»˜è³‡æ–™ï¼ˆå€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ãªã©ï¼‰ãŒã‚ã‚‹å ´åˆã¯ã€ãã®æ›¸ãæ–¹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
- ä»–ã®æ•™ç§‘ã®ç›®æ¨™ã‚„æ‰‹ç«‹ã¦ã¯å‡ºåŠ›ã›ãšã€æŒ‡å®šã•ã‚ŒãŸã€${subject}ã€‘ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
- ç›®æ¨™ã¨æ‰‹ç«‹ã¦ã®æ•°ã¯ã€è‡ªç«‹æ´»å‹•ã¨æ—¥å¸¸ç”Ÿæ´»ã®æŒ‡å°ã¯3ã¤ä»¥ä¸Šã€ãã‚Œä»¥å¤–ã¯2ã¤ã¨ã—ã¦ãã ã•ã„ã€‚
- ç›®æ¨™ã¨æ‰‹ç«‹ã¦ã®å†…å®¹ã¯ã€å…¥åŠ›ã•ã‚ŒãŸå®Ÿæ…‹ã‚„èª²é¡Œã€å‚è€ƒæŒ‡å°æ–¹é‡ã¨é€£å‹•ã•ã›ã¦å…·ä½“çš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
- **æ”¹è¡Œã®å³å®ˆ**ï¼š
   Excelã®ã‚»ãƒ«å†…ã§è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã€ã€Œãƒ»ã€ãªã©ã®ç›´å‰ã«ã¯**å¿…ãšæ”¹è¡Œ**ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚  
- **ä½™è¨ˆãªè¨˜å·ã®ç¦æ­¢**ï¼š
   - **ã€Œ**ã€ï¼ˆå¤ªå­—å¼·èª¿ï¼‰ãªã©ã®Markdownè¨˜å·ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**
`;
    });

    setP4Output(prompts.join("\n\n----------------------------------------\n\n"));
  };

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¤
  const generatePrompt5 = () => {
    let intro = "";
    let mainSource = "";
    let refText = "";

    if (p5UseFile) {
      intro = "æ·»ä»˜ã—ãŸæŒ‡å°è¨ˆç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸»ãŸã‚‹æƒ…å ±æºã¨ã—ã€";
      if (p5Reference.trim() && p5Reference !== "ï¼ˆä¾‹ï¼šå€‹åˆ¥ã®æŒ‡å°è¨ˆç”»ã®ã€ŒæŒ‡å°ã®ç›®æ¨™ãŠã‚ˆã³å†…å®¹ã€ã®å…¨æ–‡ã‚„ã€ç‰¹ã«è¦‹ã¦ã»ã—ã„éƒ¨åˆ†ãªã©ï¼‰") {
        mainSource = "ä»¥ä¸‹ã®ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ã‚‚è£œè¶³æƒ…å ±ã¨ã—ã¦è€ƒæ…®ã—ãŸä¸Šã§ã€";
        refText = `ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ï¼š\n${p5Reference}\n`;
      } else {
        mainSource = "ä»¥ä¸‹ã®";
      }
    } else {
      intro = "ä»¥ä¸‹ã®ã€æŒ‡å°è¨ˆç”»ã®ãƒ†ã‚­ã‚¹ãƒˆã€‘ã‚’ä¸»ãŸã‚‹æƒ…å ±æºã¨ã—ã¦ã€";
      refText = `ã€æŒ‡å°è¨ˆç”»ã®ãƒ†ã‚­ã‚¹ãƒˆã€‘ï¼š\n${p5Reference}\n`;
    }

    const fullPrompt = `${intro}${mainSource}ã€ã§ããŸã“ã¨ãƒ»æ´»å‹•ã®æ§˜å­ã€‘ã¨ã‚’é–¢é€£ä»˜ã‘ãªãŒã‚‰ã€æ•™ç§‘ã”ã¨ã®ã€Œå€‹åˆ¥ã®æŒ‡å°ã®è©•ä¾¡ã€ï¼ˆæŒ¯ã‚Šè¿”ã‚Šæ–‡ï¼‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
${refText}
ã€ã§ããŸã“ã¨ãƒ»æ´»å‹•ã®æ§˜å­ã€‘ï¼š
${p5Activity}

ã€å‡ºåŠ›ãƒ«ãƒ¼ãƒ«ã€‘ï¼š
- ã¾ãšã€ä¸»ãŸã‚‹æƒ…å ±æºï¼ˆæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ä¸Šè¨˜ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’èª­ã¿è¾¼ã¿ã€ãã“ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ç›®æ¨™ã‚„å†…å®¹ã‚’å®Œå…¨ã«ç†è§£ã—ã¦ãã ã•ã„ã€‚
- ã€Œï½ã§ã™ã€‚ï½ã¾ã™ã€‚ã€èª¿ã§ã¯ãªãã€ã€Œï½ã§ã‚ã‚‹ã€‚ã€èª¿ã§æ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- æ–‡ã®æœ€å¾Œã¯ã€Œï½ã§ããŸã€‚ã€ã§çµ‚ã‚ã‚‰ã›ã‚‹ã€‚
- ãã®ä¸Šã§ã€ã€ã§ããŸã“ã¨ãƒ»æ´»å‹•ã®æ§˜å­ã€‘ãŒã€è¨ˆç”»ã®ã©ã®ç›®æ¨™ãƒ»å†…å®¹ã«å¯¾å¿œã™ã‚‹ã®ã‹ã‚’åˆ†æã—ã€ç›®æ¨™ã®é”æˆåº¦åˆã„ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«è©•ä¾¡æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- è¨ˆç”»ã§è¨€åŠã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®æ•™ç§‘ãƒ»é ˜åŸŸã«ã¤ã„ã¦ã€è©•ä¾¡æ–‡ã‚’å€‹åˆ¥ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
- å„æ•™ç§‘ã«ã¤ã„ã¦ã€ã€æ•™ç§‘åã®è¦‹å‡ºã—ã€‘ã¨200ï½300æ–‡å­—ç¨‹åº¦ã®è©•ä¾¡æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- æ–‡ä½“ã¯ã€å®Ÿå‹™ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ãªæŸ”ã‚‰ã‹ãæ•™è‚²çš„ãªè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚
- å„æ•™ç§‘ã®ä¾‹ï¼ˆç¾è¡“ï¼šã€Œãƒ»ä»™å°ä¸ƒå¤•ç¥­ã‚Šã®å¹æµã—ä½œã‚Šã§ã¯ã€æŠ˜ã‚ŠæŸ“ã‚ã«å–ã‚Šçµ„ã‚“ã ã€‚æŸ“ã‚ã‚‹è‰²ã‚’ï¼“ã¤é¸æŠã—ã€æŸ“ã‚ã‚‹æ‰‹å…ƒã‚’ã‚ˆãè¦‹ã¦è‰²ã®æ»²ã¿ã«æ³¨ç›®ã—ã¦æŸ“ã‚ã‚‹ã“ã¨ãŒã§ããŸã€‚ãƒ»åœŸå™¨ä½œã‚Šã§ã¯ã¸ã‚‰ã‚„ç¸„ã€è²æ®»ã‚„ãƒ“ãƒ¼ç‰ãªã©ã‚’ç²˜åœŸã«æŠ¼ã—ä»˜ã‘ã¦æ¨¡æ§˜ã‚’ã¤ã‘ã‚‹ã“ã¨ãŒã§ããŸãƒ»åœŸå™¨ã®é‘‘è³ã§ã¯ã€å‹é”ã®ä½œå“ã®ä¸­ã‹ã‚‰æ°—ã«ã„ã£ãŸã‚‚ã®ã‚’ï¼’ã¤é¸ã¶ã“ã¨ãŒã§ããŸã€‚ã€ï¼‰          
`;

    setP5Output(fullPrompt);
  };

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¥
  const generatePrompt6 = () => {
    let intro = "";
    let mainSource = "";
    let refText = "";

    if (p6UseFile) {
      intro = "æ·»ä»˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè©•ä¾¡æ–‡ã‚„è¨ˆç”»æ›¸ãªã©ï¼‰ã‚’ä¸»ãŸã‚‹æƒ…å ±æºã¨ã—ã€";
      if (p6Reference.trim() && p6Reference !== "ï¼ˆä¾‹ï¼šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ã§ä½œæˆã—ãŸè©•ä¾¡æ–‡ã®å…¨ä½“ã€ã¾ãŸã¯ç‰¹ã«è¦‹ã¦ã»ã—ã„éƒ¨åˆ†ãªã©ï¼‰") {
        mainSource = "ä»¥ä¸‹ã®ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ã‚‚è£œè¶³æƒ…å ±ã¨ã—ã¦è€ƒæ…®ã—ã€";
        refText = `ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ï¼š\n${p6Reference}\n`;
      }
    } else {
      intro = "ä»¥ä¸‹ã®ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ã‚’ä¸»ãŸã‚‹æƒ…å ±æºã¨ã—ã¦ã€";
      refText = `ã€å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã€‘ï¼š\n${p6Reference}\n`;
    }

    let specificConditions = "";
    if (p6Term === "å‰æœŸ") {
      specificConditions = `- ã€Œå‰æœŸã¯ã€ã€œã€ã¨ã„ã£ãŸæ›¸ãå‡ºã—ã§å§‹ã‚ã¦ãã ã•ã„ã€‚
- 200ï½400æ–‡å­—ç¨‹åº¦ã®æ–‡ç« é‡ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚
- æ–‡æœ«ã«ã¯ã€Œå¾ŒæœŸã‚‚å¼•ãç¶šãã€ã”å®¶åº­ã¨é€£æºã‚’å–ã‚ŠãªãŒã‚‰ã€æˆé•·ã‚’è¦‹å®ˆã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚ã€ãªã©ã€å¾ŒæœŸã¸ã®é€£æºã‚’æ„è­˜ã—ãŸä¸€æ–‡ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚`;
    } else {
      specificConditions = `- ã€Œã“ã®1å¹´é–“ã§ã€œã€ã‚„ã€Œã„ã‚ˆã„ã‚ˆæ¥å¹´åº¦ã¯ã€œã€ãªã©ã€å¹´åº¦ã®åŒºåˆ‡ã‚Šã‚’æ„Ÿã˜ã•ã›ã‚‹æ›¸ãå‡ºã—ã«ã—ã¦ãã ã•ã„ã€‚
- 200ã€œ450æ–‡å­—ç¨‹åº¦ã®æ–‡ç« é‡ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚
- æ–‡æœ«ã«ã¯ã€ä¿è­·è€…ã¸ã®æ„Ÿè¬ã¨ã€æ¬¡å¹´åº¦ã«å‘ã‘ãŸå¿œæ´ã®è¨€è‘‰ã‚’å¿…ãšå«ã‚ã¦ãã ã•ã„ã€‚`;
    }

    const fullPrompt = `${intro}${mainSource}ã•ã‚‰ã«ã€å¼·èª¿ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆã€‘ã‚’ç››ã‚Šè¾¼ã¿ãªãŒã‚‰ã€ä¿è­·è€…å‘ã‘ã®ã€Œ${p6Term}ã®æ‰€è¦‹ã€ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
${refText}
ã€å¼·èª¿ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆã€‘ï¼š
${p6Points}

ã€å…¨ä½“ã®å…±é€šæ¡ä»¶ã€‘ï¼š
- ä¸»ãŸã‚‹æƒ…å ±æºï¼ˆæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ä¸Šè¨˜ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‹ã‚‰å…¨ä½“çš„ãªæˆé•·ã®æ§˜å­ã‚’èª­ã¿å–ã‚Šã€ã€å¼·èª¿ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆã€‘ã‚’ç‰¹ã«æ„è­˜ã—ã¦ã€è‡ªç„¶ãªæ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- æ·»ä»˜è³‡æ–™å†…ã«å…·ä½“çš„äº‹è±¡ï¼ˆä¾‹ï¼šå¤§ããªè¡Œäº‹ã®é”æˆã€å‹äººã¨ã®ã‚„ã‚Šã¨ã‚Šã€ã‘ãŒã®æœ‰ç„¡ï¼‰ãŒã‚ã‚‹å ´åˆã¯å…·ä½“ä¾‹ã‚’1ã¤ä»¥ä¸ŠæŒ™ã’ã¦æ‰€è¦‹ã«åæ˜ ã™ã‚‹ã“ã¨ã€‚
- ä¸å¯§ãªèªã‚Šå£ã§ã€å‰å‘ããªè¡¨ç¾ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
- ä¿è­·è€…ã®æ–¹ãŒèª­ã‚“ã§ã€ãŠå­ã•ã‚“ã®å…·ä½“çš„ãªæˆé•·ãŒä¼ã‚ã‚‹ã‚ˆã†ãªæ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚
- ã€Œï½ã§ã™ã€‚ï½ã¾ã™ã€‚ã€èª¿ã§ã¯ãªãã€ã€Œï½ã§ã‚ã‚‹ã€‚ã€èª¿ã§æ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- ã‚‚ã—ã€å…¥åŠ›ã€‘ã‚„æ·»ä»˜è³‡æ–™ã®å†…å®¹ãŒæ¥µç«¯ã«çŸ­ã„ãƒ»æƒ…å ±ä¸è¶³ãªå ´åˆã¯ã€å‰æœŸã¯200å­—ã€å¾ŒæœŸã¯200å­—ã‚’ä¸‹å›ã‚‰ãªã„ã‚ˆã†ã«ã€å®Ÿå‹™çš„ã«å¦¥å½“ãªè¨˜è¿°ã‚’å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ãæ¨æ¸¬ã—ã¦è£œå®Œã™ã‚‹ã“ã¨

ã€${p6Term}ç”¨ã®å€‹åˆ¥æ¡ä»¶ã€‘ï¼š
${specificConditions}`;

    setP6Output(fullPrompt);
  };

  // æ•™ç§‘é¸æŠã®ãƒãƒ³ãƒ‰ãƒ©
  const toggleSubject = (subject: string) => {
    if (p4SelectedSubjects.includes(subject)) {
      setP4SelectedSubjects(p4SelectedSubjects.filter(s => s !== subject));
      const newInputs = { ...p4SubjectInputs };
      delete newInputs[subject];
      setP4SubjectInputs(newInputs);
    } else {
      setP4SelectedSubjects([...p4SelectedSubjects, subject]);
      setP4SubjectInputs({ ...p4SubjectInputs, [subject]: "ï¼ˆä¾‹ï¼šãƒŸãƒ‹ãƒˆãƒãƒˆã®æ ½åŸ¹ã‚’è¡Œã£ãŸ...ï¼‰" });
    }
  };

  return (
    <div className="min-h-screen bg-white text-slate-900 font-sans selection:bg-purple-100 selection:text-purple-900 overflow-x-hidden relative">
      
      {/* èƒŒæ™¯ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹ */}
      <div className="fixed inset-0 z-0 opacity-10 pointer-events-none">
        <div className="w-full h-[120%] -mt-[10%] bg-[url('https://i.imgur.com/AbUxfxP.png')] bg-cover bg-center grayscale" />
        <div className="absolute inset-0 bg-white/20" />
      </div>

      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="fixed w-full top-0 left-0 p-6 z-40 bg-white/80 backdrop-blur-md border-b border-gray-200">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <Link href="/" className="flex items-center gap-2 text-slate-600 hover:text-purple-600 transition-colors">
            <ArrowLeft size={20} />
            <span className="font-bold text-sm tracking-widest">BACK TO TOP</span>
          </Link>
          <div className="flex items-center gap-3">
            <div className="w-2 h-2 bg-purple-600 rounded-full animate-pulse"></div>
            <h1 className="text-sm font-bold tracking-widest text-slate-900">MieeL <span className="text-gray-400">APP</span></h1>
          </div>
        </div>
      </header>

      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <main className="relative z-10 pt-32 pb-20 px-6 md:px-20 max-w-6xl mx-auto">
        
        {/* ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ */}
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="mb-12 text-center"
        >
          <div className="inline-flex items-center justify-center p-4 bg-purple-50 rounded-full mb-6 text-purple-600 shadow-sm">
            <Cpu size={40} />
          </div>
          <h2 className="text-4xl md:text-5xl font-bold mb-4 text-slate-900">AI æ”¯æ´ãƒ»æŒ‡å°è¨ˆç”»ä½œæˆ</h2>
          <p className="text-gray-500 max-w-2xl mx-auto leading-relaxed">
            AIã‚’æ´»ç”¨ã—ã¦ã€å€‹åˆ¥ã®æ”¯æ´è¨ˆç”»ã‚„æŒ‡å°è¨ˆç”»ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå‘½ä»¤æ–‡ï¼‰ã‚’ç°¡å˜ã«ä½œæˆã—ã¾ã™ã€‚<br/>
            ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ChatGPTã‚„Geminiã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
          </p>
        </motion.div>

        {/* ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚¨ãƒªã‚¢ */}
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.2 }}
          className="bg-white border border-gray-200 rounded-2xl p-6 mb-12 shadow-sm"
        >
          <h3 className="text-sm font-bold text-gray-500 tracking-widest mb-4 flex items-center gap-2">
            <Settings size={16} /> ãƒ¢ãƒ¼ãƒ‰é¸æŠ
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button
              onClick={() => setMode("normal")}
              className={`p-6 rounded-xl border-2 text-left transition-all ${
                mode === "normal" 
                  ? "border-purple-600 bg-purple-50 text-purple-900" 
                  : "border-gray-200 hover:border-purple-300 text-gray-600"
              }`}
            >
              <div className="font-bold text-lg mb-2 flex items-center gap-2">
                <FileText size={20} /> é€šå¸¸ãƒ¢ãƒ¼ãƒ‰
              </div>
              <p className="text-sm opacity-80 leading-relaxed">
                æ–‡ç« å½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚<br/>Wordç­‰ã«æ‰‹å‹•ã§ã‚³ãƒ”ãƒšã™ã‚‹æ–¹ã«æœ€é©ã§ã™ã€‚
              </p>
            </button>
            
            <button
              onClick={() => setMode("excel")}
              className={`p-6 rounded-xl border-2 text-left transition-all ${
                mode === "excel" 
                  ? "border-green-600 bg-green-50 text-green-900" 
                  : "border-gray-200 hover:border-green-300 text-gray-600"
              }`}
            >
              <div className="font-bold text-lg mb-2 flex items-center gap-2">
                <Sparkles size={20} /> Excelä½œæˆãƒ¢ãƒ¼ãƒ‰
              </div>
              <p className="text-sm opacity-80 leading-relaxed">
                JSONå½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚<br/>å²©æ§»ã¯ã‚‹ã‹ãœæ©Ÿèƒ½ï¼ˆExcelè‡ªå‹•å…¥åŠ›ï¼‰ç”¨ã§ã™ã€‚
              </p>
            </button>
          </div>
        </motion.div>

        {/* AIãƒãƒ£ãƒƒãƒˆãƒªãƒ³ã‚¯ */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-16">
          <a href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer" 
             className="flex items-center justify-center gap-3 p-4 bg-gray-900 text-white rounded-xl font-bold hover:bg-gray-700 transition-colors shadow-lg">
             <MessageSquare size={20} /> ChatGPT ã‚’é–‹ã
          </a>
          <a href="https://gemini.google.com/" target="_blank" rel="noopener noreferrer" 
             className="flex items-center justify-center gap-3 p-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-500 transition-colors shadow-lg">
             <Sparkles size={20} /> Gemini ã‚’é–‹ã
          </a>
        </div>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘  */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ã€ãƒ—ãƒ©ãƒ³Aï¼šãƒ‹ãƒ¼ã‚ºãƒ»åˆç†çš„é…æ…®ã€‘"
          desc="å®Ÿæ…‹ã‹ã‚‰ãƒ‹ãƒ¼ã‚ºã¨é…æ…®ã‚’å°ãå‡ºã—ã¾ã™ã€‚"
          color="purple"
          delay={0.3}
        >
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… ãŠå­ã•ã‚“ã®å®Ÿæ…‹ã‚„èª²é¡Œ</label>
              <textarea
                value={p1Input}
                onChange={(e) => setP1Input(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent min-h-[100px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt1}
              className="w-full py-4 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ã‚’ç”Ÿæˆ
            </button>

            {p1Output && <OutputArea text={p1Output} onCopy={() => copyToClipboard(p1Output)} />}
          </div>
        </PromptSection>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ã€ãƒ—ãƒ©ãƒ³Aï¼šæ‰€å±æ ¡ã®æ”¯æ´ã€‘"
          desc="ãƒ‹ãƒ¼ã‚ºã«åŸºã¥ã„ãŸå…·ä½“çš„ãªæ”¯æ´å†…å®¹ã‚’ä½œæˆã—ã¾ã™ã€‚"
          color="blue"
          delay={0.4}
        >
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… ã€Œç‰¹åˆ¥ãªæ•™è‚²çš„ãƒ‹ãƒ¼ã‚ºã€ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ã®çµæœï¼‰ã‚’è²¼ã‚Šä»˜ã‘</label>
              <textarea
                value={p2Input}
                onChange={(e) => setP2Input(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent min-h-[150px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt2}
              className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ã‚’ç”Ÿæˆ
            </button>

            {p2Output && <OutputArea text={p2Output} onCopy={() => copyToClipboard(p2Output)} color="blue" />}
          </div>
        </PromptSection>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ã€ãƒ—ãƒ©ãƒ³Bï¼šæŒ‡å°æ–¹é‡ãƒ»å®Ÿæ…‹ã€‘"
          desc="7ã¤ã®é ˜åŸŸã«åŸºã¥ã„ãŸå®Ÿæ…‹ã¨æŒ‡å°æ–¹é‡ã‚’ä½œæˆã—ã¾ã™ã€‚"
          color="emerald"
          delay={0.5}
        >
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… å®Ÿæ…‹ã‚„èª²é¡Œï¼ˆâ‘ ã¨åŒã˜ã§OKï¼‰</label>
              <textarea
                value={p3Input}
                onChange={(e) => setP3Input(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent min-h-[100px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt3}
              className="w-full py-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ã‚’ç”Ÿæˆ
            </button>

            {p3Output && <OutputArea text={p3Output} onCopy={() => copyToClipboard(p3Output)} color="emerald" />}
          </div>
        </PromptSection>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ã€æŒ‡å°è¨ˆç”»ï¼šç›®æ¨™ã¨æ‰‹ç«‹ã¦ã€‘"
          desc="æ•™ç§‘ã”ã¨ã«å€‹åˆ¥ã®ç›®æ¨™ã¨æ‰‹ç«‹ã¦ã‚’ä½œæˆã—ã¾ã™ã€‚"
          color="orange"
          delay={0.6}
        >
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-4">âœ… æ•™ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°å¯ï¼‰</label>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {SUBJECT_OPTIONS.map((subject) => (
                  <button
                    key={subject}
                    onClick={() => toggleSubject(subject)}
                    className={`
                      px-3 py-2 rounded-lg text-sm font-bold border-2 transition-all
                      ${p4SelectedSubjects.includes(subject) 
                        ? "border-orange-500 bg-orange-50 text-orange-700" 
                        : "border-gray-200 text-gray-500 hover:border-orange-300"}
                    `}
                  >
                    {subject}
                  </button>
                ))}
              </div>
            </div>

            {p4SelectedSubjects.length > 0 && (
              <div className="bg-orange-50/50 p-6 rounded-xl border border-orange-100">
                <h4 className="font-bold text-orange-800 mb-4">ğŸ’¡ å„æ•™ç§‘ã®å®Ÿæ…‹ã‚’å…¥åŠ›</h4>
                <div className="space-y-4">
                  {p4SelectedSubjects.map(subject => (
                    <div key={subject}>
                      <label className="block text-xs font-bold text-orange-600 mb-1">ã€{subject}ã€‘ã®å®Ÿæ…‹</label>
                      <textarea
                        value={p4SubjectInputs[subject] || ""}
                        onChange={(e) => setP4SubjectInputs({...p4SubjectInputs, [subject]: e.target.value})}
                        className="w-full p-3 border border-orange-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-400"
                        rows={2}
                      />
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… å…¨ä½“çš„ãªå®Ÿæ…‹ã‚„æŒ‡å°æ–¹é‡ï¼ˆå‚è€ƒï¼‰</label>
              <textarea
                value={p4Reference}
                onChange={(e) => setP4Reference(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 min-h-[100px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt4}
              className="w-full py-4 bg-orange-500 text-white font-bold rounded-xl hover:bg-orange-600 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘£ã‚’ç”Ÿæˆ
            </button>

            {p4Output && <OutputArea text={p4Output} onCopy={() => copyToClipboard(p4Output)} color="orange" />}
          </div>
        </PromptSection>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¤ */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¤ã€æŒ‡å°è¨ˆç”»ï¼šè©•ä¾¡ã€‘"
          desc="æ´»å‹•ã®æ§˜å­ã‹ã‚‰è©•ä¾¡æ–‡ã‚’ä½œæˆã—ã¾ã™ã€‚"
          color="pink"
          delay={0.7}
        >
          <div className="space-y-6">
            <div className="flex items-center gap-2">
              <input 
                type="checkbox" 
                id="useFile5" 
                checked={p5UseFile} 
                onChange={(e) => setP5UseFile(e.target.checked)}
                className="w-5 h-5 text-pink-600 rounded focus:ring-pink-500 border-gray-300" 
              />
              <label htmlFor="useFile5" className="text-sm font-bold text-gray-700 cursor-pointer">
                AIã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã—ã¦ä¸»æƒ…å ±ã¨ã—ã¦ä½¿ã†
              </label>
            </div>

            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆï¼ˆè¨ˆç”»ã®ç›®æ¨™ãªã©ï¼‰</label>
              <textarea
                value={p5Reference}
                onChange={(e) => setP5Reference(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 min-h-[100px] text-base"
              />
            </div>

            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… ã§ããŸã“ã¨ãƒ»æ´»å‹•ã®æ§˜å­</label>
              <textarea
                value={p5Activity}
                onChange={(e) => setP5Activity(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 min-h-[150px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt5}
              className="w-full py-4 bg-pink-600 text-white font-bold rounded-xl hover:bg-pink-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¤ã‚’ç”Ÿæˆ
            </button>

            {p5Output && <OutputArea text={p5Output} onCopy={() => copyToClipboard(p5Output)} color="pink" />}
          </div>
        </PromptSection>

        {/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¥ */}
        <PromptSection 
          title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¥ã€å‰æœŸãƒ»å¾ŒæœŸã®æ‰€è¦‹ã€‘"
          desc="ä¿è­·è€…å‘ã‘ã®ç·åˆçš„ãªæ‰€è¦‹ã‚’ä½œæˆã—ã¾ã™ã€‚"
          color="indigo"
          delay={0.8}
        >
          <div className="space-y-6">
            <div className="flex gap-4">
              <label className="flex items-center gap-2 cursor-pointer bg-gray-100 px-4 py-2 rounded-lg">
                <input type="radio" checked={p6Term === "å‰æœŸ"} onChange={() => setP6Term("å‰æœŸ")} className="text-indigo-600" />
                <span className="font-bold">å‰æœŸ</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer bg-gray-100 px-4 py-2 rounded-lg">
                <input type="radio" checked={p6Term === "å¾ŒæœŸï¼å­¦å¹´æœ«"} onChange={() => setP6Term("å¾ŒæœŸï¼å­¦å¹´æœ«")} className="text-indigo-600" />
                <span className="font-bold">å¾ŒæœŸï¼å­¦å¹´æœ«</span>
              </label>
            </div>

            <div className="flex items-center gap-2">
              <input 
                type="checkbox" 
                id="useFile6" 
                checked={p6UseFile} 
                onChange={(e) => setP6UseFile(e.target.checked)}
                className="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300" 
              />
              <label htmlFor="useFile6" className="text-sm font-bold text-gray-700 cursor-pointer">
                AIã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã—ã¦ä¸»æƒ…å ±ã¨ã—ã¦ä½¿ã†
              </label>
            </div>

            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… å‚è€ƒãƒ†ã‚­ã‚¹ãƒˆï¼ˆè©•ä¾¡æ–‡ãªã©ï¼‰</label>
              <textarea
                value={p6Reference}
                onChange={(e) => setP6Reference(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 min-h-[150px] text-base"
              />
            </div>

            <div>
              <label className="block text-sm font-bold text-gray-700 mb-2">âœ… å¼·èª¿ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆï¼ˆç®‡æ¡æ›¸ãï¼‰</label>
              <textarea
                value={p6Points}
                onChange={(e) => setP6Points(e.target.value)}
                className="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 min-h-[100px] text-base"
              />
            </div>
            
            <button
              onClick={generatePrompt6}
              className="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <Lightbulb size={20} /> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¥ã‚’ç”Ÿæˆ
            </button>

            {p6Output && <OutputArea text={p6Output} onCopy={() => copyToClipboard(p6Output)} color="indigo" />}
          </div>
        </PromptSection>

        {/* ============================================================
            â˜… å²©æ§»ã¯ã‚‹ã‹ãœæ©Ÿèƒ½ (Excelãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤º)
           ============================================================ */}
        <AnimatePresence>
          {mode === "excel" && (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: "auto" }}
              exit={{ opacity: 0, height: 0 }}
              className="mt-16 pt-16 border-t-2 border-dashed border-gray-300"
            >
              <div className="bg-green-50 border-2 border-green-200 rounded-3xl p-8 shadow-inner">
                <div className="flex items-center gap-3 mb-6">
                  <div className="p-3 bg-green-600 text-white rounded-xl">
                    <Sparkles size={24} />
                  </div>
                  <div>
                    <h3 className="text-2xl font-bold text-green-900">å²©æ§»ã¯ã‚‹ã‹ãœæ©Ÿèƒ½ (Excelè‡ªå‹•å…¥åŠ›)</h3>
                    <p className="text-green-700 text-sm">AIãŒç”Ÿæˆã—ãŸJSONã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Excelã«å‡ºåŠ›ã—ã¾ã™ã€‚</p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div className="space-y-4">
                    <h4 className="font-bold text-green-800">1. ãƒ—ãƒ©ãƒ³A (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ãƒ»â‘¡ã®çµæœ)</h4>
                    <textarea 
                      placeholder='ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘ ã®JSONçµæœã‚’è²¼ã‚Šä»˜ã‘ (needs, accommodations)'
                      value={json1} onChange={(e) => setJson1(e.target.value)}
                      className="w-full h-32 p-3 text-xs font-mono border border-green-200 rounded-xl focus:ring-2 focus:ring-green-500"
                    />
                    <textarea 
                      placeholder='ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¡ã®JSONçµæœã‚’è²¼ã‚Šä»˜ã‘ (goals, support)'
                      value={json2} onChange={(e) => setJson2(e.target.value)}
                      className="w-full h-32 p-3 text-xs font-mono border border-green-200 rounded-xl focus:ring-2 focus:ring-green-500"
                    />
                  </div>
                  
                  <div className="space-y-4">
                    <h4 className="font-bold text-green-800">2. ãƒ—ãƒ©ãƒ³B (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ã®çµæœ)</h4>
                    <textarea 
                      placeholder='ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ‘¢ã®JSONçµæœã‚’è²¼ã‚Šä»˜ã‘ (policy, status...)'
                      value={json3} onChange={(e) => setJson3(e.target.value)}
                      className="w-full h-[270px] p-3 text-xs font-mono border border-green-200 rounded-xl focus:ring-2 focus:ring-green-500"
                    />
                  </div>
                </div>

                <div className="mt-8">
                  <button
                    onClick={handleGenerateExcel}
                    disabled={isGenerating}
                    className="w-full py-5 bg-green-600 text-white text-lg font-bold rounded-2xl hover:bg-green-700 transition-all shadow-xl hover:shadow-2xl disabled:opacity-50 flex items-center justify-center gap-3"
                  >
                    {isGenerating ? (
                      <span className="animate-pulse">å‡¦ç†ä¸­...</span>
                    ) : (
                      <>
                        <Download size={24} /> Excelã‚’ä½œæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                      </>
                    )}
                  </button>
                  <p className="text-center text-xs text-green-600 mt-3 font-bold">
                    â€» publicãƒ•ã‚©ãƒ«ãƒ€ã«ã€Œãƒ—ãƒ©ãƒ³.xlsxã€ãŒå¿…è¦ã§ã™ã€‚
                  </p>
                </div>
              </div>
            </motion.div>
          )}
        </AnimatePresence>

      </main>

      <footer className="bg-gray-50 border-t border-gray-200 py-12 text-center text-gray-500 text-xs">
        &copy; 2025 MieeL Project. All Rights Reserved.
      </footer>
    </div>
  );
}

// ==========================================
// éƒ¨å“ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ä»˜ã)
// ==========================================

function PromptSection({ title, desc, children, color, delay }: any) {
  // è‰²ã‚¹ã‚¿ã‚¤ãƒ«ã®ç°¡æ˜“å®šç¾©
  const styles: any = {
    purple: "border-purple-200 bg-purple-50",
    blue: "border-blue-200 bg-blue-50",
    emerald: "border-emerald-200 bg-emerald-50",
    orange: "border-orange-200 bg-orange-50",
    pink: "border-pink-200 bg-pink-50",
    indigo: "border-indigo-200 bg-indigo-50",
  };
  
  // æŠ˜ã‚ŠãŸãŸã¿ç”¨ã®State
  const [isOpen, setIsOpen] = useState(false);

  return (
    <motion.div
      initial={{ opacity: 0, y: 30 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: delay, duration: 0.8 }}
      className={`bg-white border rounded-3xl mb-6 transition-all shadow-sm hover:shadow-lg overflow-hidden ${styles[color]}`}
    >
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="w-full p-6 flex items-center justify-between text-left focus:outline-none"
      >
        <div className="flex items-center gap-4">
          <div className={`p-2 rounded-xl bg-white/50`}>
            <CheckCircle size={24} className={`text-${color}-600`} />
          </div>
          <div>
            <h3 className="text-xl font-bold text-slate-900">{title}</h3>
            <p className="text-gray-500 text-sm">{desc}</p>
          </div>
        </div>
        {isOpen ? <ChevronUp className="text-gray-400" /> : <ChevronDown className="text-gray-400" />}
      </button>
      
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: "auto", opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            className="border-t border-gray-100 bg-white"
          >
            <div className="p-8">
              {children}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

function OutputArea({ text, onCopy, color="gray" }: any) {
  return (
    <motion.div 
      initial={{ opacity: 0, height: 0 }}
      animate={{ opacity: 1, height: "auto" }}
      className="bg-gray-50 border border-gray-200 rounded-xl p-4 mt-6 relative"
    >
      <div className="flex justify-between items-center mb-2 px-2">
        <span className="text-xs font-bold text-gray-400 uppercase tracking-wider">Generated Prompt</span>
        <button
          onClick={onCopy}
          className="flex items-center gap-2 px-3 py-1.5 bg-white border rounded-lg hover:bg-gray-100 text-xs font-bold shadow-sm"
        >
          <Copy size={14} /> ã‚³ãƒ”ãƒ¼
        </button>
      </div>
      <pre className="whitespace-pre-wrap text-sm text-slate-800 font-mono bg-white p-4 rounded-lg border border-gray-100 overflow-x-auto">
        {text}
      </pre>
    </motion.div>
  );
}